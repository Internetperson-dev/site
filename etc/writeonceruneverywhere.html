<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello World Program</title>

    <!-- Manifest Link -->
    <link rel="manifest" href="">

    <!-- Service Worker Registration -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Dynamically create and assign the manifest file
            const manifest = {
                "name": "Hello World PWA",
                "short_name": "HelloWorld",
                "description": "A simple Hello World Progressive Web App",
                "start_url": "/",
                "display": "standalone",
                "background_color": "#ffffff",
                "theme_color": "#000000",
                "icons": [
                    {
                        "src": "https://example.com/icon.png",
                        "sizes": "192x192",
                        "type": "image/png"
                    },
                    {
                        "src": "https://example.com/icon-512.png",
                        "sizes": "512x512",
                        "type": "image/png"
                    }
                ]
            };
            
            const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
            const manifestUrl = URL.createObjectURL(manifestBlob);
            document.querySelector("link[rel='manifest']").setAttribute('href', manifestUrl);

            // Register Service Worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/service-worker.js')
                        .then(registration => {
                            console.log('Service Worker registered with scope:', registration.scope);
                        })
                        .catch(error => {
                            console.log('Service Worker registration failed:', error);
                        });
                });
            }
        });
    </script>

</head>
<body>
    <script>
        document.write('Hello World');
    </script>

    <!-- Service Worker Script (included inline for now) -->
    <script>
        if ('serviceWorker' in navigator) {
            const swScript = `
                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open('v1').then(cache => {
                            return cache.addAll([
                                '/',
                                '/index.html'
                            ]);
                        })
                    );
                });

                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request).then(response => {
                            return response || fetch(event.request);
                        })
                    );
                });
            `;
            
            const swBlob = new Blob([swScript], { type: 'application/javascript' });
            const swBlobUrl = URL.createObjectURL(swBlob);
            
            // Register the Service Worker from the Blob URL
            navigator.serviceWorker.register(swBlobUrl)
                .then(registration => {
                    console.log('Service Worker registered successfully with blob URL:', registration);
                })
                .catch(error => {
                    console.log('Service Worker registration failed with blob URL:', error);
                });
        }
    </script>
</body>
</html>
