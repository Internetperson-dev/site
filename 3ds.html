<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platformer Game with 3DS Controls</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
        /* Adjust the canvas size for the 3DS screen */
        #gameCanvas {
            width: 400px;
            height: 240px;
        }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Set canvas size to fit 3DS screen
    if (is3DS()) {
        canvas.width = 400;
        canvas.height = 240;
    } else {
        canvas.width = 800; // Desktop default size
        canvas.height = 400;
    }

    // Platformer game variables
    let player = {
        x: 50,
        y: 50,
        width: 20,
        height: 20,
        speed: 5,
        velocityY: 0,
        gravity: 0.5,
        onGround: false
    };

    let keys = {};

    // Detect if it's a 3DS browser
    function is3DS() {
        return window.navigator.userAgent.includes("Nintendo 3DS");
    }

    // Handle keydown events for controls (D-pad and buttons)
    window.addEventListener('keydown', function (e) {
        const key = keycodes[e.keyCode];
        if (key) {
            keys[key] = true;
        }
    });

    // Handle keyup events
    window.addEventListener('keyup', function (e) {
        const key = keycodes[e.keyCode];
        if (key) {
            keys[key] = false;
        }
    });

    // Keycodes for 3DS D-pad and A button
    const keycodes = {
        13: "A",     // Enter key
        65: "A",     // A key
        37: "Left",  // Left arrow
        38: "Up",    // Up arrow
        39: "Right", // Right arrow
        40: "Down"   // Down arrow
    };

    // Game update function (runs every frame)
    function update() {
        // Player movement logic
        if (keys["Left"]) {
            player.x -= player.speed;
        }
        if (keys["Right"]) {
            player.x += player.speed;
        }
        if (keys["Up"] && player.onGround) {
            player.velocityY = -10; // Jump
            player.onGround = false;
        }

        // Apply gravity
        player.velocityY += player.gravity;
        player.y += player.velocityY;

        // Collision detection (simple ground check)
        if (player.y + player.height > canvas.height) {
            player.y = canvas.height - player.height;
            player.velocityY = 0;
            player.onGround = true;
        }

        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw player
        ctx.fillStyle = 'blue';
        ctx.fillRect(player.x, player.y, player.width, player.height);

        requestAnimationFrame(update);
    }

    // Start the game loop
    update();

    // Prevent arrow keys from scrolling the page
    window.addEventListener("keydown", function(e) {
        if ([37, 38, 39, 40].includes(e.keyCode)) {
            e.preventDefault();
        }
    });
</script>

</body>
</html>
